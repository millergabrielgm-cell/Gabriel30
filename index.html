<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gabriel 30 Anos | Cheers!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #f8fafc;
            -webkit-tap-highlight-color: transparent;
        }
        .font-serif { font-family: 'Playfair Display', serif; }
        .gold-text {
            background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .btn-gold {
            background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
            color: #000;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .rsvp-btn { transition: all 0.2; border: 1px solid rgba(255, 255, 255, 0.1); }
        .rsvp-btn.active-yes { background: rgba(217, 119, 6, 0.2); border-color: #d97706; color: #fbbf24; }
        .rsvp-btn.active-no { background: rgba(239, 68, 68, 0.1); border-color: #ef4444; color: #f87171; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div class="max-w-md w-full glass-card rounded-[2rem] overflow-hidden shadow-2xl">
        <!-- Banner -->
        <div class="h-44 bg-cover bg-center relative" style="background-image: url('https://images.unsplash.com/photo-1470337458703-46ad1756a187?auto=format&fit=crop&q=80&w=800');">
            <div class="absolute inset-0 bg-black/60 flex flex-col items-center justify-center">
                <h1 class="font-serif text-5xl font-bold gold-text italic">G30</h1>
                <p class="text-[10px] tracking-[0.4em] uppercase text-slate-500 mt-2 italic">The Celebration</p>
            </div>
        </div>

        <!-- Conteúdo -->
        <div class="p-8 space-y-8">
            <div class="text-center space-y-2">
                <h2 class="text-2xl font-serif">Você foi convocado</h2>
                <p class="text-slate-400 font-light text-sm text-center">Belmonte do Touring | 28/02 às 17h</p>
            </div>

            <!-- Formulário RSVP -->
            <div id="form-ui" class="space-y-5">
                <div class="space-y-2 text-left">
                    <label class="text-[10px] uppercase text-slate-500 ml-1 tracking-widest">Nome Completo</label>
                    <input type="text" id="guestName" placeholder="Seu nome aqui..." 
                           class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-4 outline-none focus:border-amber-500 transition-all text-white">
                </div>

                <div class="flex gap-2">
                    <button id="yBtn" onclick="setOpt(true)" class="rsvp-btn flex-1 py-4 rounded-xl text-[10px] font-bold uppercase tracking-widest bg-white/5">eu aceito a convocação</button>
                    <button id="nBtn" onclick="setOpt(false)" class="rsvp-btn flex-1 py-4 rounded-xl text-[10px] font-bold uppercase tracking-widest bg-white/5 text-slate-500">resignar</button>
                </div>

                <button id="submitBtn" onclick="submitData()" class="btn-gold w-full py-5 rounded-2xl font-bold uppercase tracking-widest text-xs shadow-lg">
                    Confirmar na Lista
                </button>
            </div>

            <!-- Mensagem de Sucesso -->
            <div id="success-ui" class="hidden py-10 text-center space-y-4">
                <div class="w-12 h-12 bg-green-500/20 text-green-500 rounded-full flex items-center justify-center mx-auto">✓</div>
                <h3 class="text-xl font-serif">Confirmado!</h3>
                <p class="text-slate-400 text-sm">Sua presença está salva na lista.</p>
            </div>
        </div>

        <!-- Rodapé / Painel Administrativo -->
        <div class="p-4 bg-black/20 text-center border-t border-white/5">
            <button onclick="viewList()" class="text-[9px] text-slate-600 uppercase tracking-widest hover:text-amber-500 transition-colors">
                [ Acesso do Gabriel ]
            </button>
        </div>
    </div>

    <!-- Lista de Convidados (Painel Admin) -->
    <div id="admin-panel" class="hidden max-w-md w-full glass-card rounded-3xl p-6 mt-6 shadow-2xl mb-10">
        <div class="flex justify-between items-center border-b border-white/10 pb-4 mb-4">
            <h3 class="font-serif text-lg gold-text">Lista de Convidados</h3>
            <button onclick="document.getElementById('admin-panel').classList.add('hidden')" class="text-slate-500 text-xs">FECHAR</button>
        </div>
        <div id="guest-list" class="space-y-2 max-h-64 overflow-y-auto pr-2 text-sm text-left">
            <!-- Dados serão inseridos aqui -->
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, query, serverTimestamp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        let db, appId, isAttending = null;

        // Inicialização do Firebase
        try {
            const firebaseConfig = JSON.parse(__firebase_config);
            appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            db = getFirestore(app);
            signInAnonymously(auth);
        } catch (e) { console.warn("Firebase Offline"); }

        // Definir opção de presença
        window.setOpt = (val) => {
            isAttending = val;
            document.getElementById('yBtn').className = val ? 'rsvp-btn flex-1 py-4 rounded-xl text-[10px] font-bold uppercase tracking-widest active-yes' : 'rsvp-btn flex-1 py-4 rounded-xl text-[10px] font-bold uppercase tracking-widest bg-white/5';
            document.getElementById('nBtn').className = !val ? 'rsvp-btn flex-1 py-4 rounded-xl text-[10px] font-bold uppercase tracking-widest active-no' : 'rsvp-btn flex-1 py-4 rounded-xl text-[10px] font-bold uppercase tracking-widest bg-white/5 text-slate-500';
        };

        // Submeter dados para a base de dados
        window.submitData = async () => {
            const name = document.getElementById('guestName').value.trim();
            const btn = document.getElementById('submitBtn');
            if(!name || isAttending === null) return alert("Preencha o seu nome e selecione uma opção.");

            try {
                btn.disabled = true; btn.innerText = "A GUARDAR...";
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'guests'), {
                    name, attending: isAttending, date: serverTimestamp()
                });
                document.getElementById('form-ui').classList.add('hidden');
                document.getElementById('success-ui').classList.remove('hidden');
            } catch (e) {
                alert("Erro ao ligar ao servidor. Tente novamente.");
                btn.disabled = false; btn.innerText = "Confirmar na Lista";
            }
        };

        // Visualizar lista de convidados
        window.viewList = async () => {
            const pass = prompt("Palavra-passe:");
            if(pass !== "30anos") return alert("Palavra-passe errada.");
            
            const panel = document.getElementById('admin-panel');
            const listDiv = document.getElementById('guest-list');
            panel.classList.remove('hidden');
            listDiv.innerHTML = "A carregar...";

            try {
                const snap = await getDocs(query(collection(db, 'artifacts', appId, 'public', 'data', 'guests')));
                let html = "";
                let guests = [];
                snap.forEach(d => guests.push(d.data()));
                
                // Ordenar por nome em memória
                guests.sort((a,b) => a.name.localeCompare(b.name));
                
                guests.forEach(g => {
                    const color = g.attending ? 'text-amber-500' : 'text-red-500';
                    html += `<div class="flex justify-between p-3 bg-white/5 rounded-lg border border-white/5">
                        <span class="truncate">${g.name}</span>
                        <span class="text-[9px] font-bold ${color}">${g.attending ? 'VAI' : 'NÃO'}</span>
                    </div>`;
                });
                listDiv.innerHTML = html || "Nenhuma confirmação ainda.";
            } catch (e) { listDiv.innerHTML = "Erro ao carregar a lista."; }
        };
    </script>
</body>
</html>